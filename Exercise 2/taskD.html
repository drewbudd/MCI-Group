<!doctype html>
<html>
<head>
<title>Human Capabilities - Reaction test</title> </head>
<body>
<script type="text/javascript">
	var experimentActive = false; 
	var testActive = false;
	var times = new Array();
	var lastTimeColorChanged;
	var falseEntry;
	var sheepPicShown = 0;
	var sheepSoundPlayed = 0;
	
	function startExperiment() {
		document.getElementById("sheepImg").style.display = 'none';
		experimentActive = true;
		falseEntry = 0;
		document.getElementById("text").innerHTML = "";
		document.getElementById("time").innerHTML = "";
		document.getElementById("count").innerHTML = "";
		document.getElementById("mean").innerHTML = "";
		document.getElementById("sd").innerHTML = "";
		document.getElementById("error").innerHTML = "";
		document.getElementById("instruction").innerHTML = "Press SPACE when you see or hear the sheep! Press 'a' for results!";
		startTest();
	}
	
	function startTest() {
		timeInSeconds = Math.random() * 4 + 2; // 2 - 6s
		window.setTimeout("showStimulus()", timeInSeconds * 1000);
	}
	
	function showStimulus() {
		testActive = true;
		sheepStimulus();
	}
	
	function sheepStimulus() {
		
		if (sheepPicShown < 5) {
			sheepPicShown++;
			document.getElementById("sheepImg").style.display = 'inline';
			lastTimeColorChanged = new Date().getTime();
		} else if (sheepSoundPlayed < 5) {
			sheepSoundPlayed++;
			document.getElementById("sheepSnd").play();
			lastTimeColorChanged = new Date().getTime();
		} else {
			testActive = false;
			stopExperiment();
		}
	}
	
	function stopTest() {
		document.getElementById("sheepImg").style.display = 'none';
		//document.getElementById("sheepSnd").stop();
		var currTime = new Date().getTime();
		var deltaTime = currTime - lastTimeColorChanged;
		times.push(deltaTime);
		document.getElementById("time").innerHTML = deltaTime + "ms";
		testActive = false;
		startTest();
	}
	
	function stopExperiment() {
		window.setTimeout("showStimulus()", 0);
		testActive = false;
		var meanDeltaTime = 0.0;
		for (var i = 0; i < times.length; ++i) {
			meanDeltaTime += times[i]; 
		}
		meanDeltaTime = Math.round(meanDeltaTime / times.length);
		var standardDerivation = 0.0;
		for (var i = 0; i < times.length; ++i) {
			var diff = (times[i] - meanDeltaTime);
			standardDerivation += diff * diff; 
		}
		var errorRate = (falseEntry / (falseEntry + times.length)) * 100;
		standardDerivation = Math.round(Math.sqrt(standardDerivation / times.length));
		document.getElementById("count").innerHTML = "Count: " + times.length;
		document.getElementById("mean").innerHTML = "Mean: " + meanDeltaTime + "ms";
		document.getElementById("sd").innerHTML = "SD: " + standardDerivation +	"ms";
		document.getElementById("error").innerHTML = "Error rate: " + errorRate.toFixed(2) + "%";
		document.getElementById("instruction").innerHTML = "Press SPACE to start!";
		times = [];
		experimentActive = false;
	}
	
	function changeTextColor(newColor) {
		document.getElementById("text").style.color = newColor;
		document.getElementById("text").style.backgroundColor = newColor;
		lastTimeColorChanged = new Date().getTime();
	}
	
	document.onkeydown = function onKey(e) { 
		
		if (e == null) {
			e = window.event;
		}
		
		switch (e.which || e.charCode || e.keyCode) {
			case 32:
			// space
				if (!experimentActive) {
					startExperiment(); 
				}
				else {
					if (testActive) {
						stopTest();
					} else {
						falseEntry++;
					}
				}
				break;
			case 65: // a
				if (experimentActive) {
					stopExperiment();
				}
				break;
			//case 66:
				// b
				// here you can extend... alert("pressed the b key"); break;
				//break;
		}
		
	}
</script>
		<h1><p id="text">User Study</p></h1>
		<h1 id="instruction">Press SPACE to start!</h1>
		<p><img id="sheepImg" src="sheep.jpg" style="display:none"></p>
		<audio id="sheepSnd" src="sheep.wav" preload="auto"></audio>
		<p>
		<p id="time"></p> <p id="count"></p> <p id="mean"></p> <p id="sd"></p> <p id="error"></p> 
	</body>
</html>
